"use strict";function isU(e){return"undefined"==typeof e}function isD(e){return"undefined"!=typeof e}function _log(){for(var e=arguments.length,t=0;e>t;t+=1)"object"==typeof arguments[t]?console.dir(arguments[t]):console.log(arguments[t])}function apiPath(){return"https://test.sendsay.ru/admin/api/"}function apiRequest(e){return{request:JSON.stringify(e),apiversion:100,json:1}}var App=angular.module("app",["app.sumstat","ui.bootstrap","ui.router","LocalStorageModule","ngAnimate","angularMoment"]).run(["amMoment",function(e){e.changeLocale("ru")}]);App.directive("tarifInfo",function(){var e={B:{name:"Базовый",limit:{email:null,sms:null},showChange:0},R:{name:"Расширеный",limit:{email:null,sms:null},price:0,showChange:0},N:{name:"Начальный",limit:{email:null,sms:null},price:0,showChange:0},O:{name:"Оптимальный",limit:{email:null,sms:null},price:0,showChange:0},P:{name:"Профессиональный",limit:{email:null,sms:null},price:0,showChange:0},E:{name:"Эксперт",limit:{email:null,sms:null},price:0,showChange:0},V:{name:"Премиум",limit:{email:null,sms:null},price:0,showChange:0},S:{name:"Свои",limit:{email:null,sms:null},price:0,showChange:0},F:{name:"Старт",limit:{email:200,sms:null},price:0,showChange:0},U:{name:"Т1",limit:{email:2e3,sms:null},price:0,showChange:0},Q:{name:"Т2",limit:{email:1e4,sms:null},price:0,showChange:0},X:{name:"Т3",limit:{email:2e4,sms:null},price:0,showChange:0},Y:{name:"Т4",limit:{email:35e3,sms:null},price:0,showChange:0},Z:{name:"Т5",limit:{email:5e4,sms:null},price:0,showChange:0},T:{name:"Тестовый",limit:{email:null,sms:null},price:0,showChange:0},trial:{name:"Триал",limit:{email:null,sms:null},price:0,showChange:0},B1:{name:"Бизнес 1",id:"Sendsay_B1_fee",limit:{email:1e3,sms:null},price:750,showChange:1},B2:{name:"Бизнес 2",id:"Sendsay_B2_fee",limit:{email:2500,sms:null},price:1300,showChange:1},B5:{name:"Бизнес 5",id:"Sendsay_B5_fee",limit:{email:5e3,sms:null},price:2e3,showChange:1},B10:{name:"Бизнес 10",id:"Sendsay_B10_fee",limit:{email:1e4,sms:null},price:3300,showChange:1},B25:{name:"Бизнес 25",id:"Sendsay_B25_fee",limit:{email:25e3,sms:null},price:6500,showChange:1},B50:{name:"Бизнес 50",id:"Sendsay_B50_fee",limit:{email:5e4,sms:null},price:10300,showChange:1},I:{name:"Индивидуальный",limit:{email:0,sms:null},price:null,showChange:1},T1:{name:"Т1",limit:{email:2e3,sms:null},price:0,showChange:0},T2:{name:"Т2",limit:{email:1e4,sms:null},price:0,showChange:0},T3:{name:"Т3",limit:{email:2e4,sms:null},price:0,showChange:0},T4:{name:"Т4",limit:{email:35e3,sms:null},price:0,showChange:0},T5:{name:"Т5",limit:{email:5e4,sms:null},price:0,showChange:0}};return{scope:{},restrict:"E",replace:!0,link:function(t,s,a,n){var r=a.code||!1,i=a.option||"name";s.text(_.get(e,[r,i],"Unknown"))}}});var AppFilters=angular.module("AppFilters",[]);AppFilters.filter("sumstatPaginationFilter",function(){return _log("sumstatpagination arguments:",arguments),function(e,t,s){return e.slice((t-1)*s,t*s-1)}}),App.config(["$stateProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider",function(e,t,s,a){_log("app config ..."),s.html5Mode(!0),a.setPrefix("SA"),t.when("/","/sumstat").otherwise("/404")}]),App.controller("favoritesCtrl",["$scope","$rootScope",function(e,t){e.removeFromFavorites=function(t){_log("removeFromFavorites: "+t),e.$emit("removeFromFavorites",{ID:t})},e.showDrop=function(){},t.$watch("favoriteUsers",function(){_log("event",arguments)}),e.$on("favoriteUserChange",function(t,s){var a=e.favoriteUsers,n=$.inArray(s.ID,a);-1==n?a.push(s.ID):delete a[n],e.localStorage.set("favoriteUsers",a.join(","))}),_log("favoritesCtrl ...")}]),App.controller("MainCtrl",["$rootScope",function(e){e.windowTitle="MyFirst Page in Angular"}]),App.controller("NavogationCtrl",["$scope","$location",function(e,t){_log("NavogationCtrl ..."),e.mainMenu=[{name:"Sumstat",icon:"glyphicon glyphicon-signal",path:"/sumstat/",state:"sumstat.list"},{name:"Delivstat",path:"/delivstat/",state:"delivstat.list",icon:"glyphicon glyphicon-pencil"},{name:"Payment",path:"/payment/",state:"payment.list",icon:"glyphicon glyphicon-euro"},{name:"Tarif",path:"/tarif/",state:"tarif.list",icon:"glyphicon glyphicon-briefcase"},{name:"Sending",path:"/sending/",state:"sending.list",icon:"glyphicon glyphicon-envelope"}],e.$watchCollection("mainMenu",function(){_log("Performe RUN: "+$("#left-panel").length),$("#left-panel").css({left:-80,opacity:.25}).animate({left:0,opacity:1},500)})}]),App.controller("TopSearchCtrl",["$scope","$state","$rootScope","$location",function(e,t,s,a){e.searchlist=[{name:"chrights",code:"chrights"},{name:"Defer",code:"defer"},{name:"Chenv",code:"chenv"}],e.doSearch=function(t){0==e.searchSection},e.$watch("searchInput",function(e){_log("searchInput",e)}),e.searchSection=0,e.setSection=function(t,s){e.searchSection=s,t.preventDefault(),_log("setSection arguments:",arguments)}}]);var AppSumstat=angular.module("app.sumstat",["ui.router","LocalStorageModule","AppFilters"]).config(["$stateProvider","$httpProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider",function(e,t,s,a,n){_log("app.sumstat config ..."),s.when("/sumstat/","/sumstat"),t.defaults.useXDomain=!0,t.defaults.withCredentials=!0,delete t.defaults.headers.common["X-Requested-With"],e.state("sumstat",{"abstract":!0,url:"/sumstat",template:'<div class="ui-main-conteiner" ui-view></div>',resolve:["$q","$http","$rootScope","$state","$stateParams","localStorageService",function(e,t,s,a,n,r){var i=e.defer();_log("$http.defaults.headers:",t.defaults.headers),s.$state=a,s.$stateParams=n,s.localStorage=r,s.userList=[],s.activeUsers=[],s.blockedUsers=[],r.get("favoriteUsers")?s.favoriteUsers=r.get("favoriteUsers").split(","):s.favoriteUsers=[],s.isFavoriteUser=function(e){return-1!=$.inArray(e,s.favoriteUsers)},s.$on("removeFromFavorites",function(e,t){var a=$.inArray(t.ID,s.favoriteUsers);-1!=a&&(s.favoriteUsers.splice(a,1),r.set("favoriteUsers",s.favoriteUsers.join(",")))}),_log("$rootScope.favoriteUsers",s.favoriteUsers);var o=apiRequest({action:"account.sumstat"});return _log("_apiRequest_: ",o),$.post(apiPath(),o,function(e){_log("jQuery post:",e)}),t.post(apiPath(),o).success(function(e){var t=Object.keys(e.list).length;if(s.userList=e,s.userListLink={},_log("$rootScope.userList",Object.keys(e.list).length),e.list&&t)for(var a in e.list)"0"==user.BLOCKED?s.blockedUsers.push(user.ID):s.activeUsers.push(user.ID);s.$emit("changeUserList"),i.resolve()}).error(function(e,t,s,a){}),i.promise}]}).state("sumstat.list",{url:"",templateUrl:"pages/sumstat/list/template.html",controller:"SumstatListCtrl"}).state("sumstat.view",{"abstract":!0,url:"/view/:userId",templateUrl:"pages/sumstat/user_view/template.html",controller:["$scope","$stateParams",function(e,t){var s=e.userListLink[t.userId];e.user=e.userList[s]}]}).state("sumstat.view.detail",{url:"",templateUrl:"pages/sumstat/user_view/card/template.html",controller:"SumstatUserViewCtrl"})}]);AppSumstat.controller("SumstatListCtrl",["$scope","$rootScope","$location",function(e,t,s){e.userCount=t.userList.length,e.currentPage=s.search().page||1,e.sortType=s.search().sortType||"ID",e.sortReverse=s.search().sortReverse||!1,e.changeSort=function(t){e.sortReverse=e.sortType!=t?0:!e.sortReverse,e.sortType=t},e.favoriteUser=function(e,s){t.$broadcast("favoriteUserChange",{ID:s})},e.pageChanged=function(){s.search("page",e.currentPage)},e.$watch("sortType",function(){s.search("sortType",e.sortType)}),e.$watch("sortReverse",function(){s.search("sortReverse",e.sortReverse?1:null)}),e.checkOnDrop=function(e,t){var s=$(e.currentTarget).parents(".ui-table-dropdown-item"),a=e.currentTarget.checked;s[(a?"add":"remove")+"Class"]("ui-table-dropdown-checked")},t.$on("changeUserList",function(){e.userCount=t.userList.length}),e.showAdvCols={},e.tableCols=[{key:"manager",name:"Менеджер",checked:0},{key:"seller",name:"Продавец",checked:0},{key:"tarif",name:"Тариф",checked:0},{key:"adress",name:"Адрес",checked:0},{key:"lastIssue",name:"Последний выпуск",checked:0},{key:"memberCount",name:"Адресов в базе",checked:0}],angular.forEach(e.tableCols,function(t,s){e.showAdvCols[t.key]=0})}]),AppSumstat.controller("SumstatUserViewCtrl",["$scope","$stateParams","$location",function(e,t,s){e.user=e.userList[t.userId],e.userJSON=JSON.stringify(e.user).replace(/\,/gi,",\n").replace(/\{/gi,"{\n").replace(/\}/gi,"\n}")}]),angular.module("content",["sumstat","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,s){e.state(".sumstat",{url:"/sumstat/list",templateUrl:"pages/sumstat/list/template.html",controller:"SumstatListCtrl"}),t.otherwise("/sumstat/list")}]);