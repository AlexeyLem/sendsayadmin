function isU(e){return"undefined"==typeof e}function isD(e){return"undefined"!=typeof e}function _log(){for(var e=arguments.length,t=0;e>t;t+=1)"object"==typeof arguments[t]?console.dir(arguments[t]):console.log(arguments[t])}var App=angular.module("app",["app.auth","app.sumstat","ui.bootstrap","ui.router","LocalStorageModule","ngAnimate","angularMoment"]).run(["$rootScope","$state","$stateParams","amMoment",function(e,t,n,s){_log("App run ..."),e.$on("$stateChangeStart",function(e,t,n,s,r,a){_log("$stateChangeStart: ",arguments)}),s.changeLocale("ru"),e.$state=t,e.$stateParams=n,e.user=null}]),AppAuth=angular.module("app.auth",["ui.router"]).run(["Auth","$rootScope",function(e,t){_log("AppAuth run ..."),t.isAuthenticated=e.isAuthenticated()}]).controller("AuthCtrl",["$scope","$rootScope","Auth",function(e,t,n){e.loginModel="alexey",e.passwordModel="",e.loginError=!1,e.passwordError=!1,e.Auth=function(t){_log("$scope.Auth Call ...",e.loginModel,e.passwordModel);var s=!0;""==$.trim(e.loginModel)&&(s=!1,e.loginError=!0),""==$.trim(e.passwordModel)&&(s=!1,e.passwordError=!0),s&&(e.loginError=!1,e.passwordError=!1,n.login({login:$.trim(e.loginModel),password:$.trim(e.passwordModel)}))},e.keyAuth=function(t){13==t.keyCode?e.Auth():27==t.keyCode}}]).factory("Auth",["$http","$q","Api",function(e,t,n){var s=!0;return{isAuthenticated:function(){return s},login:function(e){var s=t.defer();return n.login({login:e.login,password:e.password}).success(function(e){_log("Auth login success Data:",e),s.resolve(e)}).error(function(e,t,n,r){_log("Auth login error Data:",arguments),s.reject(e)}),s.promise}}}]);App.factory("Api",["$q",function(e){var t="https://test.sendsay.ru/admin/api/";return{_prepeareRequest:function(e){return{request:JSON.stringify(e),apiversion:100,json:1}},hasError:function(e){return isD(e.errors)&&e.errors.length},request:function(n,s){s=s||{};var r=this,a=e.defer(),o=this._prepeareRequest(n),i={url:t,crossDomain:!0,async:!0,cache:!1,dataType:"json",global:!0,method:s.method||"post",data:o,error:function(e){_log("API ERROR: ",arguments)},success:function(e){r.hasError(e)?a.reject(e):a.resolve(e)}};return $.ajax(i),a.promise},login:function(e){return $http({method:"POST",url:t+"api/",data:{credential_0:e.login,credential_1:e.password}})}}}]),App.factory("SumstatFavorites",["$rootScope","localStorageService",function(e,t){var n="sumstatFavoriteUsers";t.get(n)||t.set(n,"");var s=t.get(n).split(",")||[],r=function(){t.set(n,s.join(","))},a={getList:function(){return s.slice(0)},Add:function(t){t=t||null,"object"!=typeof t&&t&&!this.inList(t)&&(s.push(t),r(),e.$broadcast("SumstatFavorites_Add",t),e.$broadcast("SumstatFavorites_Change",s))},Remove:function(t){t=t||null;var n=$.inArray(t,s);"object"!=typeof t&&t&&-1!=n&&(s.splice(n,1),r(),e.$broadcast("SumstatFavorites_Remove",t),e.$broadcast("SumstatFavorites_Change",s))},inList:function(e){return-1!=$.inArray(e,s)}};return a}]);var AppFilters=angular.module("AppFilters",[]);AppFilters.filter("sumstatPaginationFilter",function(){return _log("sumstatpagination arguments:",arguments),function(e,t,n){return e.slice((t-1)*n,t*n-1)}}),AppFilters.filter("searchFilter",function(){return function(e,t){return""==t?e:_.filter(e,function(e){return-1!=e.TITLE.indexOf(t)||-1!=e.ID.indexOf(t)?!0:!1})}}),App.directive("tarifInfo",function(){var e={B:{name:"Базовый",limit:{email:null,sms:null},showChange:0},R:{name:"Расширеный",limit:{email:null,sms:null},price:0,showChange:0},N:{name:"Начальный",limit:{email:null,sms:null},price:0,showChange:0},O:{name:"Оптимальный",limit:{email:null,sms:null},price:0,showChange:0},P:{name:"Профессиональный",limit:{email:null,sms:null},price:0,showChange:0},E:{name:"Эксперт",limit:{email:null,sms:null},price:0,showChange:0},V:{name:"Премиум",limit:{email:null,sms:null},price:0,showChange:0},S:{name:"Свои",limit:{email:null,sms:null},price:0,showChange:0},F:{name:"Старт",limit:{email:200,sms:null},price:0,showChange:0},U:{name:"Т1",limit:{email:2e3,sms:null},price:0,showChange:0},Q:{name:"Т2",limit:{email:1e4,sms:null},price:0,showChange:0},X:{name:"Т3",limit:{email:2e4,sms:null},price:0,showChange:0},Y:{name:"Т4",limit:{email:35e3,sms:null},price:0,showChange:0},Z:{name:"Т5",limit:{email:5e4,sms:null},price:0,showChange:0},T:{name:"Тестовый",limit:{email:null,sms:null},price:0,showChange:0},trial:{name:"Триал",limit:{email:null,sms:null},price:0,showChange:0},B1:{name:"Бизнес 1",id:"Sendsay_B1_fee",limit:{email:1e3,sms:null},price:750,showChange:1},B2:{name:"Бизнес 2",id:"Sendsay_B2_fee",limit:{email:2500,sms:null},price:1300,showChange:1},B5:{name:"Бизнес 5",id:"Sendsay_B5_fee",limit:{email:5e3,sms:null},price:2e3,showChange:1},B10:{name:"Бизнес 10",id:"Sendsay_B10_fee",limit:{email:1e4,sms:null},price:3300,showChange:1},B25:{name:"Бизнес 25",id:"Sendsay_B25_fee",limit:{email:25e3,sms:null},price:6500,showChange:1},B50:{name:"Бизнес 50",id:"Sendsay_B50_fee",limit:{email:5e4,sms:null},price:10300,showChange:1},I:{name:"Индивидуальный",limit:{email:0,sms:null},price:null,showChange:1},T1:{name:"Т1",limit:{email:2e3,sms:null},price:0,showChange:0},T2:{name:"Т2",limit:{email:1e4,sms:null},price:0,showChange:0},T3:{name:"Т3",limit:{email:2e4,sms:null},price:0,showChange:0},T4:{name:"Т4",limit:{email:35e3,sms:null},price:0,showChange:0},T5:{name:"Т5",limit:{email:5e4,sms:null},price:0,showChange:0}};return{scope:{},restrict:"E",replace:!0,link:function(t,n,s,r){var a=s.code||!1,o=s.option||"name";_log(a,o),n.text(_.get(e,[a,o],"Unknown"))}}}),App.config(["$stateProvider","$urlRouterProvider","$locationProvider","localStorageServiceProvider",function(e,t,n,s){_log("App config ..."),n.html5Mode(!0),s.setPrefix("SA"),s.setStorageType("localStorage"),t.when("/","/sumstat").when("/sumstat/","/sumstat").otherwise("/404")}]),App.controller("MainCtrl",["$rootScope","$state","$stateParams","Auth","localStorageService",function(e,t,n,s,r){e.windowTitle="MyFirst Page in Angular"}]),App.controller("favoritesCtrl",["$scope","$rootScope","SumstatFavorites",function(e,t,n){t.sumstatFavoriteUsers=n.getList(),t.isFavoriteUser=function(e){return n.inList(e)},e.removeFromFavorites=function(e){_log("removeFromFavorites: "+e),n.Remove(e)},e.$watch("sumstatFavoriteUsers",function(){_log("event",arguments)}),e.$on("SumstatFavorites_Change",function(e,t){}),e.showDrop=function(){},_log("favoritesCtrl ...")}]),App.controller("NavogationCtrl",["$scope","$location",function(e,t){_log("NavogationCtrl ..."),e.mainMenu=[{name:"Sumstat",icon:"glyphicon glyphicon-signal",path:"/sumstat/",state:"sumstat.list"},{name:"Delivstat",path:"/delivstat/",state:"delivstat.list",icon:"glyphicon glyphicon-pencil"},{name:"Payment",path:"/payment/",state:"payment.list",icon:"glyphicon glyphicon-euro"},{name:"Tarif",path:"/tarif/",state:"tarif.list",icon:"glyphicon glyphicon-briefcase"},{name:"Sending",path:"/sending/",state:"sending.list",icon:"glyphicon glyphicon-envelope"}],e.$watchCollection("mainMenu",function(){_log("Performe RUN: "+$("#left-panel").length),$("#left-panel").css({left:-80,opacity:.25}).animate({left:0,opacity:1},500)})}]),App.controller("TopSearchCtrl",["$scope","$state","$rootScope","$location",function(e,t,n,s){e.searchlist=[{name:"chrights",code:"chrights"},{name:"Defer",code:"defer"},{name:"Chenv",code:"chenv"}],e.doSearch=function(t){0==e.searchSection},e.$watch("searchInput",function(e){_log("searchInput",e),s.search("search",e),n.$broadcast("topSearchChange",e)}),e.searchSection=0,e.setSection=function(t,n){e.searchSection=n,t.preventDefault(),_log("setSection arguments:",arguments)}}]);var AppSumstat=angular.module("app.sumstat",["ui.router","LocalStorageModule","AppFilters"]).config(["$stateProvider","$httpProvider","$urlRouterProvider","$locationProvider",function(e,t,n,s){_log("app.sumstat config ..."),e.state("sumstat",{"abstract":!0,url:"/sumstat",template:'<div class="ui-main-conteiner" ui-view></div>',resolve:{data:["$q","$rootScope","Api",function(e,t,n){var s=e.defer();_log("AppSumstat base state resolve ... "),t.userList=[],t.userList_keyLink={},t.activeUsers=[],t.blockedUsers=[];var r=function(e){_log("Api Request:",e);var n=Object.keys(e.list).length,r=[];if(t.userCount=n,_log("$rootScope.userCount: "+Object.keys(e.list).length),e.list&&n){for(var a in e.list){var o=e.list[a];t.userList_keyLink[a]=r.push(o)-1,"0"==o.BLOCKED?t.blockedUsers.push(o.ID):t.activeUsers.push(o.ID)}t.userList=r}t.$emit("changeUserList"),s.resolve()};return _log("Api.request ...",n),n.request({action:"account.sumstat"}).then(r),s.promise}]}}).state("sumstat.list",{url:"",templateUrl:"pages/sumstat/list/template.html",controller:"SumstatListCtrl"}).state("sumstat.view",{"abstract":!0,url:"/view/:userId",templateUrl:"pages/sumstat/user_view/template.html",controller:["$scope","$stateParams",function(e,t){var n=e.userList_keyLink[t.userId];e.user=e.userList[n]}]}).state("sumstat.view.detail",{url:"",templateUrl:"pages/sumstat/user_view/card/template.html",controller:"SumstatUserViewCtrl"})}]);!function(){function e(e,t,n,s,r){e.userCount=t.userList.length,e.currentPage=n.search().page||1,e.sortType=n.search().sortType||"ID",e.sortReverse=n.search().sortReverse||!1,e.search=n.search().search||"",e.showAdvCols={},e.tableCols=[{key:"manager",name:"Менеджер",checked:0},{key:"seller",name:"Продавец",checked:0},{key:"tarif",name:"Тариф",checked:0},{key:"adress",name:"Адрес",checked:0},{key:"lastIssue",name:"Последний выпуск",checked:0},{key:"memberCount",name:"Адресов в базе",checked:0}],angular.forEach(e.tableCols,function(t,n){e.showAdvCols[t.key]=0}),e.changeSort=function(t){e.sortReverse=e.sortType!=t?0:!e.sortReverse,e.sortType=t},e.favoriteUser=function(e,t){r.inList(t)?r.Remove(t):r.Add(t)},e.pageChanged=function(t){e.currentPage=t,n.search("page",t)},e.checkOnDrop=function(e,t){var n=$(e.currentTarget).parents(".ui-table-dropdown-item"),s=e.currentTarget.checked;n[(s?"add":"remove")+"Class"]("ui-table-dropdown-checked")},e.$watch("sortType",function(){n.search("sortType",e.sortType)}),e.$watch("sortReverse",function(){n.search("sortReverse",e.sortReverse?1:null)}),e.$on("topSearchChange",function(t,n){_log("FIRE: topSearchChange ..."),e.search=n}),t.$on("changeUserList",function(){e.userCount=Object.keys(t.userList).length})}AppSumstat.controller("SumstatListCtrl",["$scope","$rootScope","$location","Api","SumstatFavorites",e])}(),AppSumstat.controller("SumstatUserViewCtrl",["$scope","$rootScope","$stateParams","$location",function(e,t,n,s){_log("$stateParams.userId: "+n.userId);var r=t.userList_keyLink[n.userId];e.user=t.userList[r],_log("$scope.user: ",_.extend({},e.user)),e.userJSON=JSON.stringify(e.user).replace(/\,/gi,",\n").replace(/\{/gi,"{\n").replace(/\}/gi,"\n}")}]);